<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Space Shooter</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Space Shooter">
<link rel="apple-touch-icon" href="icon.png">

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  overflow: hidden;
  touch-action: none;
  font-family: sans-serif;
}
canvas {
  display: block;
  margin: 0 auto;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
// ===== CANVAS =====
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  const ratio = 9 / 16;
  const w = window.innerWidth;
  const h = window.innerHeight;
  if (w / h > ratio) {
    canvas.height = h;
    canvas.width = h * ratio;
  } else {
    canvas.width = w;
    canvas.height = w / ratio;
  }
}
window.addEventListener("resize", resize);
resize();

// ===== STATES =====
const MENU = 0;
const SETTINGS = 1;
const GAME = 2;
const PAUSE = 3;
const GAME_OVER = 4;
let state = MENU;

// ===== AUDIO =====
const musicList = [
  new Audio("music1.mp3"),
  new Audio("music2.mp3"),
  new Audio("music3.mp3")
];
let musicIndex = 0;
let musicVolume = 0.3;
let sfxVolume = 0.4;

musicList.forEach(m => { m.loop = true; m.volume = musicVolume; });

const laserSound = new Audio("laser.wav");
const gameOverSound = new Audio("gameover.wav");
const recordSound = new Audio("record.wav");

// ===== STORAGE =====
let record = Number(localStorage.getItem("record")) || 0;

// ===== INPUT =====
let touchX = null;

canvas.addEventListener("touchstart", e => {
  const r = canvas.getBoundingClientRect();
  const y = e.touches[0].clientY - r.top;

  if (state === MENU) {
    // START
    if (y > canvas.height * 0.52 && y < canvas.height * 0.60) {
      startGame();
    }
    // SETTINGS
    else if (y > canvas.height * 0.62 && y < canvas.height * 0.70) {
      state = SETTINGS;
    }
  }
  else if (state === SETTINGS) {
    if (y > canvas.height * 0.80) state = MENU;
  }
  else if (state === GAME_OVER) {
    state = MENU;
  }
});

// ===== START GAME =====
function startGame() {
  state = GAME;
  musicList.forEach(m => m.pause());
  musicList[musicIndex].currentTime = 0;
  musicList[musicIndex].play();
}

// ===== STARS =====
const stars = Array.from({ length: 120 }, () => ({
  x: Math.random(),
  y: Math.random(),
  s: Math.random() * 2 + 1
}));

function drawStars() {
  ctx.fillStyle = "white";
  for (let s of stars) {
    s.y += s.s / 300;
    if (s.y > 1) s.y = 0;
    ctx.fillRect(s.x * canvas.width, s.y * canvas.height, s.s, s.s);
  }
}

function center(text, y, size = 24) {
  ctx.fillStyle = "white";
  ctx.font = `${size}px sans-serif`;
  ctx.textAlign = "center";
  ctx.fillText(text, canvas.width / 2, y);
}

// ===== UPDATE =====
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawStars();

  if (state === MENU) {
    center("SPACE SHOOTER", canvas.height * 0.38, 44); // чуть больше
    center("START", canvas.height * 0.56, 22);
    center("SETTINGS", canvas.height * 0.66, 22);
    center("RECORD: " + record, canvas.height * 0.78, 18);
    return;
  }

  if (state === SETTINGS) {
    center("SETTINGS", canvas.height * 0.35, 32);
    center("BACK", canvas.height * 0.82, 20);
    return;
  }

  if (state === GAME_OVER) {
    center("GAME OVER", canvas.height * 0.45, 40);
    center("TAP TO MENU", canvas.height * 0.55, 18);
  }
}

// ===== LOOP =====
(function loop() {
  update();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
