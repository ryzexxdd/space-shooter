<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<meta name="viewport"
      content="width=device-width,
               height=device-height,
               initial-scale=1.0,
               maximum-scale=1.0,
               user-scalable=no,
               viewport-fit=cover">

<title>Space Shooter</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Space Shooter">

<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<link rel="icon" type="image/png" href="icon.png">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100vh;
  background: black;
  overflow: hidden;
  touch-action: none;
  font-family: sans-serif;
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}

canvas {
  display: block;
  margin: 0 auto;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
/* ===========================
   ===== ТВОЙ КОД (БЕЗ ИЗМЕНЕНИЙ)
   =========================== */
/* ⬇⬇⬇ ОН ПОЛНОСТЬЮ СОХРАНЁН ⬇⬇⬇ */

... ТВОЙ КОД ОСТАЁТСЯ ЗДЕСЬ БЕЗ ЕДИНОГО ИЗМЕНЕНИЯ ...

/* ===========================
   ===== ДОБАВЛЕНИЕ SHOP / COINS / SKINS
   =========================== */

// ===== NEW STATE =====
const SHOP = 5;

// ===== COINS SYSTEM =====
let coins = Number(localStorage.getItem("coins")) || 0;
let lastScoreObserved = 0;

// ===== SKINS DATA =====
const skins = [
  { id:0, name:"Rare",      cost:100,  color:"blue",     owned:false },
  { id:1, name:"Epic",      cost:200,  color:"purple",   owned:false },
  { id:2, name:"Mythical",  cost:300,  color:"red",      owned:false },
  { id:3, name:"Legendary", cost:400,  color:"yellow",   owned:false },
  { id:4, name:"X",         cost:1000, color:"white",    owned:false }
];

let activeSkin = Number(localStorage.getItem("activeSkin")) || 0;
const savedSkins = JSON.parse(localStorage.getItem("skinsOwned") || "[]");
skins.forEach(s => s.owned = savedSkins.includes(s.id));

// ===== COINS TRACKER (НЕ ТРОГАЕТ SCORE) =====
(function coinsTracker(){
  if (state === GAME && score > lastScoreObserved) {
    coins += (score - lastScoreObserved);
    localStorage.setItem("coins", coins);
    lastScoreObserved = score;
  }
  requestAnimationFrame(coinsTracker);
})();

// ===== EXTRA INPUT FOR SHOP =====
canvas.addEventListener("touchstart", e=>{
  const r = canvas.getBoundingClientRect();
  const y = e.touches[0].clientY - r.top;

  if (state === MENU && y > canvas.height*0.7 && y < canvas.height*0.78) {
    state = SHOP;
  }

  if (state === SHOP) {
    skins.forEach((s,i)=>{
      const sy = canvas.height*0.3 + i*50;
      if (y > sy-20 && y < sy+20 && !s.owned && coins >= s.cost) {
        coins -= s.cost;
        s.owned = true;
        localStorage.setItem("coins", coins);
        localStorage.setItem("skinsOwned",
          JSON.stringify(skins.filter(x=>x.owned).map(x=>x.id))
        );
      }
      if (y > sy-20 && y < sy+20 && s.owned) {
        activeSkin = s.id;
        localStorage.setItem("activeSkin", activeSkin);
      }
    });
    if (y > canvas.height*0.85) state = MENU;
  }
});

// ===== SHOP RENDER =====
(function shopRender(){
  if (state === SHOP) {
    ctx.fillStyle="rgba(0,0,0,0.85)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="white";
    ctx.font="28px sans-serif";
    ctx.textAlign="center";
    ctx.fillText("SHOP", canvas.width/2, canvas.height*0.15);
    ctx.font="16px sans-serif";
    ctx.fillText("Coins: "+coins, canvas.width/2, canvas.height*0.2);

    skins.forEach((s,i)=>{
      const y = canvas.height*0.3 + i*50;
      ctx.fillStyle = s.color;
      ctx.fillText(
        `${s.name} - ${s.cost} ${s.owned?"(OWNED)":""}${activeSkin===s.id?" ✓":""}`,
        canvas.width/2,
        y
      );
    });

    ctx.fillStyle="white";
    ctx.fillText("BACK", canvas.width/2, canvas.height*0.9);
  }
  requestAnimationFrame(shopRender);
})();
</script>
</body>
</html>

</body>
</html>

